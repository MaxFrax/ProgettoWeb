CREATE TABLE RETAILER
(
	ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	LATITUDE FLOAT NOT NULL,
	LONGITUDE FLOAT NOT NULL,
	POSTAL_CODE INTEGER NOT NULL,
	CITY VARCHAR(50) NOT NULL,
	STREET_NAME VARCHAR(100) NOT NULL,
	STREET_NUMBER INT,
	PROVINCE VARCHAR(50) NOT NULL,
	OPEN_TIMETABLE TEXT,
	SHOP_ID INTEGER NOT NULL,
	PRIMARY_KEY(ID),
	FOREIGN KEY(SHOP_ID) REFERENCES SHOP(ID)
);

CREATE TABLE SHOP
(
	ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	NAME VARCHAR(100) NOT NULL,
	DESCRIPTION VARCHAR(255),
	WEBSITE VARCHAR(255),
	RATING INTEGER CHECK(RATING >= 0 AND RATING <= 5),
	OWNER_ID INTEGER NOT NULL,
	PRIMARY_KEY(ID),
	FOREIGN KEY(OWNER_ID) REFERENCES USER(ID)
);

CREATE TABLE USER
(
	ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	NAME VARCHAR (100) NOT NULL,
	LASTNAME VARCHAR (100) NOT NULL,
	USERNAME VARCHAR (100) NOT NULL,
	EMAIL VARCHAR(255) NOT NULL,
	HASH_PASSWORD VARCHAR(255) NOT NULL,
	TYPE ENUM('REGISTERED', 'SELLER', 'ADMINISTRATOR') NOT NULL,
	PRIMARY_KEY(ID),
	UNIQUE(EMAIL),
	UNIQUE(USERNAME)
);

CREATE TABLE ITEM 
(
	ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	NAME VARCHAR(100) NOT NULL,
	DESCRIPTION VARCHAR(255),
	PRICE FLOAT NOT NULL,
	SELLER_ID INTEGER NOT NULL,
	CATEGORY_ID INTEGER NOT NULL,
	PRIMARY_KEY(ID),
	FOREIGN KEY(CATEGORY_ID) REFERENCES CATEGORY(ID),
	FOREIGN KEY(SELLER_ID) REFERENCES SHOP(ID)

);

CREATE TABLE CATEGORY
(
	ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	NAME VARCHAR(100) NOT NULL,
	PRIMARY_KEY(ID)
);

CREATE TABLE REVIEW
(
	ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	DESCRIPTION TEXT NOT NULL,
	RATING INTEGER CHECK(RATING >= 0 AND RATING <= 5),
	ITEM_ID INTEGER NOT NULL,
	USER_ID INTEGER NOT NULL,
	PRIMARY_KEY(ID),
	FOREIGN KEY(ITEM_ID) REFERENCES ITEM(ID),
	FOREIGN KEY(USER_ID) REFERENCES USER(ID)
	
);

CREATE TABLE PHOTO 
(
	ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	LINK VARCHAR(255)
	ITEM_ID INTEGER,
	SHOP_ID INTEGER,
	PRIMARY_KEY(ID),
	FOREIGN KEY(ITEM_ID) REFERENCES ITEM(ID),
	FOREIGN KEY(SHOP_ID) REFERENCES SHOP(ID)
);

CREATE TABLE PURCHASE
(
	ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	ITEM_ID INTEGER NOT NULL,
	USER_ID INTEGER NOT NULL,
	PRIMARY_KEY(ID),
	FOREIGN KEY(ITEM_ID) REFERENCES ITEM(ID),
	FOREIGN KEY(USER_ID) REFERENCES USER(ID)
);

CREATE TABLE ISSUE
(
	ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	USER_DESCRIPTION TEXT NOT NULL,
	ADMIN_CHOICE ENUM('REFUND', 'DO_NOTHING', 'BAD_REVIEW', 'NOT_VALID'),
	PURCHASE_ID INTEGER NOT NULL,
	PRIMARY_KEY(ID),
	FOREIGN KEY(PURCHASE_ID) REFERENCES PURCHASE(ID)
);
